<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="index.js"></script>
  <script>
    function startClearKey() {
      const video = document.querySelector('video');

      const assetURL = 'output_frag_encrypted.mp4';
      const videoCodec = 'avc1.42C01E';
      const audioCodec = 'mp4a.40.2';
      const mime = `video/mp4; codecs="${videoCodec}, ${audioCodec}"`;
      const videoContentType = `video/mp4;codecs="${videoCodec}"`;
      const audioContentType = `audio/mp4;codecs="${audioCodec}"`;
      const encryption_kid = hexToUint8Array('a53fcebc83532682766c7d0e012fe92f');
      const encryption_key = hexToUint8Array('9c61173d2db8939009be4bd689533ade');

      setMediaKeysClearKey(video, videoContentType, audioContentType, encryption_key);
      setMediaSourceConcatenated(video, assetURL, mime);
    }

    function startClearKey2() {
      const video = document.querySelector('video');

      const assets = [
        {
          urls:
            ['https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/2/init.mp4']
              .concat(
                Array.from({ length: 9 }, (_, idx) =>
                  `https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/2/${('00000' + (idx + 1)).slice(-4)}.m4s`)),
          mimeCodec: 'video/mp4; codecs="avc1.64001f"'
        },
        {
          urls:
            ['https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/15/init.mp4']
              .concat(
                Array.from({ length: 9 }, (_, idx) =>
                  `https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/15/${('00000' + (idx + 1)).slice(-4)}.m4s`)),
          mimeCodec: 'audio/mp4; codecs="mp4a.40.29"'
        },
      ];
      const encryption_kid = hexToUint8Array('nrQFDeRLSAKTLifXUIPiZg');
      const encryption_key = hexToUint8Array('FmY0xnWCPCNaSpRG-tUuTQ');
      const videoContentType = assets[0].mimeCodec;
      const audioContentType = assets[1].mimeCodec;

      setMediaKeysClearKey(video, videoContentType, audioContentType, encryption_key);
      setMediaSource(video, assets);
    }

    function startSimple() {
      const video = document.querySelector('video');
      // https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd
      const assets = [
        {
          urls:
            Array.from({ length: 11 }, (_, idx) =>
              `https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps_640x360_1000k/bbb_30fps_640x360_1000k_${idx}.m4v`),
          mimeCodec: 'video/mp4; codecs="avc1.64001e"'
        },
        {
          urls:
            Array.from({ length: 11 }, (_, idx) =>
              `https://dash.akamaized.net/akamai/bbb_30fps/bbb_a64k/bbb_a64k_${idx}.m4a`),
          mimeCodec: 'audio/mp4; codecs="mp4a.40.5"'
        }
      ];

      setMediaSource(video, assets);
    }

    function startWidevine() {
      const video = document.querySelector('video');

      // https://reference.dashif.org/dash.js/latest/samples/drm/widevine.html
      // https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/Manifest_1080p.mpd
      const assets = [
        {
          urls:
            ['https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/2/init.mp4']
              .concat(
                Array.from({ length: 5 }, (_, idx) =>
                  `https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/2/000${idx + 1}.m4s`)),
          mimeCodec: 'video/mp4; codecs="avc1.64001f"'
        },
        {
          urls:
            ['https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/15/init.mp4']
              .concat(
                Array.from({ length: 5 }, (_, idx) =>
                  `https://media.axprod.net/TestVectors/v7-MultiDRM-SingleKey/15/000${idx + 1}.m4s`)),
          mimeCodec: 'audio/mp4; codecs="mp4a.40.29"'
        },
      ];
      const licenseServerInfo = {
        "serverURL": "https://drm-widevine-licensing.axtest.net/AcquireLicense",
        "httpRequestHeaders": {
          "X-AxDRM-Message": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoxLCJjb21fa2V5X2lkIjoiYjMzNjRlYjUtNTFmNi00YWUzLThjOTgtMzNjZWQ1ZTMxYzc4IiwibWVzc2FnZSI6eyJ0eXBlIjoiZW50aXRsZW1lbnRfbWVzc2FnZSIsImZpcnN0X3BsYXlfZXhwaXJhdGlvbiI6NjAsInBsYXlyZWFkeSI6eyJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX0sImtleXMiOlt7ImlkIjoiOWViNDA1MGQtZTQ0Yi00ODAyLTkzMmUtMjdkNzUwODNlMjY2IiwiZW5jcnlwdGVkX2tleSI6ImxLM09qSExZVzI0Y3Iya3RSNzRmbnc9PSJ9XX19.FAbIiPxX8BHi9RwfzD7Yn-wugU19ghrkBFKsaCPrZmU"
        },
        "cenc_pssh": "AAAANHBzc2gAAAAA7e+LqXnWSs6jyCfc1R0h7QAAABQIARIQnrQFDeRLSAKTLifXUIPiZg==",
      };
      const videoContentType = assets[0].mimeCodec;
      const audioContentType = assets[1].mimeCodec;
      setMediaKeysWidevine(video, videoContentType, audioContentType, licenseServerInfo);
      setMediaSource(video, assets);
    }

  </script>
</head>

<body>

  <div>
    <video controls></video>
    <button onclick="startClearKey()">START org.w3.clearkey</button>
    <button onclick="startClearKey2()">START org.w3.clearkey 2</button>
    <button onclick="startSimple()">START simple</button>
    <button onclick="startWidevine()">START widevine</button>
  </div>

  <p>(CC) Blender Foundation | mango.blender.org</p>
</body>

</html>